server{
      listen 8081;
      access_log /var/log/nginx/looklook.com_access.log;
      error_log /var/log/nginx/looklook.com_error.log;


      location ~ /order/ {
           proxy_set_header Host $http_host;
           proxy_set_header X-Real-IP $remote_addr;
           proxy_set_header REMOTE-HOST $remote_addr;
           proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
           proxy_pass http://looklook:1001;
      }
      location ~ /payment/ {
          proxy_set_header Host $http_host;
          proxy_set_header X-Real-IP $remote_addr;
          proxy_set_header REMOTE-HOST $remote_addr;
          proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
          proxy_pass http://looklook:1002;
      }
      location ~ /travel/ {
         proxy_set_header Host $http_host;
         proxy_set_header X-Real-IP $remote_addr;
         proxy_set_header REMOTE-HOST $remote_addr;
         proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
         proxy_pass http://looklook:1003;
      }
      location ~ /usercenter/ {
         proxy_set_header Host $http_host;
         proxy_set_header X-Real-IP $remote_addr;
         proxy_set_header REMOTE-HOST $remote_addr;
         proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
         proxy_pass http://looklook:1004;
      }

}

# 改进建议
# 1) 路由匹配优化：将 `location ~ /xxx/` 改为 `location ^~ /xxx/` 或前缀匹配提升性能与行为可控性
# 2) 反向代理健壮性：设置超时与 keep-alive，并补充协议头
#    proxy_connect_timeout 5s;
#    proxy_read_timeout 60s;
#    proxy_send_timeout 60s;
#    proxy_http_version 1.1;
#    proxy_set_header X-Forwarded-Proto $scheme;
#    proxy_set_header X-Forwarded-Host $host;
# 3) 上游负载均衡：使用 upstream 定义多实例，并在 location 中指向 upstream 名称
#    upstream order_api { server looklook:1001; }
#    location ^~ /order/ { proxy_pass http://order_api; }
# 4) 请求大小限制：根据业务需要设置
#    client_max_body_size 10m;
# 5) 特殊协议：如需 WebSocket/SSE，在相关路径增加 Upgrade 头
#    proxy_set_header Upgrade $http_upgrade;
#    proxy_set_header Connection "upgrade";
